{% extends "base.html" %}

{% block title %}DLFI - {{ vault_name }}{% endblock %}

{% block header_left %}
<div class="vault-indicator">
	<div class="dot {{ 'encrypted' if encrypted else '' }}"></div>
	<span>{{ vault_name }}</span>
</div>
{% endblock %}

{% block header_right %}
<button class="btn btn-sm btn-secondary" onclick="App.showCreateNode('VAULT')">+ Vault</button>
<button class="btn btn-sm btn-secondary" onclick="App.showCreateNode('RECORD')">+ Record</button>
<button class="btn btn-sm btn-secondary" onclick="App.exportStatic()">Export</button>
<a href="/close" class="btn btn-sm btn-secondary">Close</a>
{% endblock %}

{% block content %}
<div class="query-bar">
	<div class="query-input-wrapper">
		<input type="text" 
			id="queryInput" 
			class="query-input" 
			placeholder="Search... (type / to focus, ? for help)"
			autocomplete="off"
			spellcheck="false">
		<div id="autocompleteDropdown" class="autocomplete-dropdown hidden"></div>
	</div>
	<button class="btn btn-secondary" id="queryHelpBtn" title="Query Help">?</button>
</div>

<div class="query-stats" id="queryStats">Loading...</div>

<div class="results-container">
	<div class="results-list-wrapper">
		<div id="queryResults">
			<div class="loading"><div class="spinner"></div></div>
		</div>
	</div>
	
	<div id="detailPanel" class="detail-panel hidden">
		<div class="detail-header" id="detailHeader"></div>
		<div class="detail-body" id="detailBody"></div>
	</div>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox hidden">
	<button class="lightbox-close" id="lightboxClose">&times;</button>
	<div class="lightbox-content" id="lightboxContent"></div>
</div>
{% endblock %}

{% block modals %}
<!-- Create Node Modal -->
<div id="createNodeModal" class="modal-overlay hidden">
	<div class="modal">
		<div class="modal-header">
			<h2 class="modal-title">Create Node</h2>
		</div>
		<div class="modal-body">
			<div class="form-group">
				<label class="form-label">Type</label>
				<select id="createNodeType" class="form-input">
					<option value="VAULT">Vault (Folder)</option>
					<option value="RECORD">Record (Item)</option>
				</select>
			</div>
			<div class="form-group">
				<label class="form-label">Path</label>
				<input type="text" id="createNodePath" class="form-input" placeholder="path/to/node">
				<p class="form-hint">Full path including parent folders</p>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-secondary" onclick="document.getElementById('createNodeModal').classList.add('hidden')">Cancel</button>
			<button class="btn btn-primary" onclick="App.createNode()">Create</button>
		</div>
	</div>
</div>

<!-- Add Tag Modal -->
<div id="addTagModal" class="modal-overlay hidden">
	<div class="modal">
		<div class="modal-header">
			<h2 class="modal-title">Add Tag</h2>
		</div>
		<div class="modal-body">
			<div class="form-group">
				<label class="form-label">Tag</label>
				<input type="text" id="newTagInput" class="form-input" placeholder="Enter tag">
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-secondary" onclick="document.getElementById('addTagModal').classList.add('hidden')">Cancel</button>
			<button class="btn btn-primary" onclick="App.addTag()">Add</button>
		</div>
	</div>
</div>

<!-- Query Help Modal -->
<div id="queryHelpModal" class="modal-overlay hidden">
	<div class="modal modal-xl">
		<div class="modal-header">
			<h2 class="modal-title">Query Syntax Help</h2>
		</div>
		<div class="modal-body" id="queryHelpContent">
			<div class="loading"><div class="spinner"></div></div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" onclick="document.getElementById('queryHelpModal').classList.add('hidden')">Close</button>
		</div>
	</div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('newTagInput')?.addEventListener('keypress', (e) => {
	if (e.key === 'Enter') App.addTag();
});

document.getElementById('createNodePath')?.addEventListener('keypress', (e) => {
	if (e.key === 'Enter') App.createNode();
});
</script>
{% endblock %}